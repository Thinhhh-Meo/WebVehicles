@model Discount
@{
    ViewData["Title"] = "Create Discount";
    ViewData["Controller"] = "Discount";
    ViewData["Action"] = "Create";
}

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Create New Discount</h4>
            </div>
            <div class="card-body">
                <form asp-area="Admin" asp-controller="Discount" asp-action="Create" method="post">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                    <div class="row">
                        <!-- Discount Name -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="DiscountName" class="form-label">Discount Name *</label>
                            <input asp-for="DiscountName" class="form-control" placeholder="e.g., Summer Sale, First Order Discount">
                            <span asp-validation-for="DiscountName" class="text-danger small"></span>
                        </div>

                        <!-- Discount Code -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="Code" class="form-label">Discount Code *</label>
                            <div class="input-group">
                                <input asp-for="Code" class="form-control" placeholder="e.g., SUMMER2024" id="discountCode">
                                <button type="button" class="btn btn-outline-secondary" onclick="generateCode()">
                                    <i class="fas fa-random"></i>
                                </button>
                            </div>
                            <span asp-validation-for="Code" class="text-danger small"></span>
                            <div class="form-text">Leave empty to auto-generate</div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        <label asp-for="Description" class="form-label">Description</label>
                        <textarea asp-for="Description" class="form-control" rows="2"
                                  placeholder="Describe the discount..."></textarea>
                        <span asp-validation-for="Description" class="text-danger small"></span>
                    </div>

                    <div class="row">
                        <!-- Discount Type -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="DiscountType" class="form-label">Discount Type *</label>
                            <select asp-for="DiscountType" class="form-select" id="discountType">
                                <option value="@DiscountType.Percentage">Percentage (%)</option>
                                <option value="@DiscountType.FixedAmount">Fixed Amount (VND)</option>
                            </select>
                            <span asp-validation-for="DiscountType" class="text-danger small"></span>
                        </div>

                        <!-- Discount Value -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="DiscountValue" class="form-label">Discount Value *</label>
                            <div class="input-group">
                                <input asp-for="DiscountValue" type="number" step="0.01" class="form-control"
                                       placeholder="e.g., 20 for 20% or 50000 for 50,000 VND">
                                <span class="input-group-text" id="valueSuffix">%</span>
                            </div>
                            <span asp-validation-for="DiscountValue" class="text-danger small"></span>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Start Date -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="DateStart" class="form-label">Start Date *</label>
                            <input asp-for="DateStart" type="datetime-local" class="form-control">
                            <span asp-validation-for="DateStart" class="text-danger small"></span>
                        </div>

                        <!-- End Date -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="DateEnd" class="form-label">End Date *</label>
                            <input asp-for="DateEnd" type="datetime-local" class="form-control">
                            <span asp-validation-for="DateEnd" class="text-danger small"></span>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Usage Limit -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="UsageLimit" class="form-label">Usage Limit</label>
                            <input asp-for="UsageLimit" type="number" class="form-control" placeholder="Leave empty for unlimited">
                            <span asp-validation-for="UsageLimit" class="text-danger small"></span>
                            <div class="form-text">Maximum number of times this discount can be used</div>
                        </div>

                        <!-- Min Order Amount -->
                        <div class="col-md-6 mb-3">
                            <label asp-for="MinOrderAmount" class="form-label">Minimum Order Amount (VND)</label>
                            <input asp-for="MinOrderAmount" type="number" step="1000" class="form-control" placeholder="Optional">
                            <span asp-validation-for="MinOrderAmount" class="text-danger small"></span>
                            <div class="form-text">Minimum order amount required to use this discount</div>
                        </div>
                    </div>

                    <!-- Discount Value Type -->
                    <div class="mb-3">
                        <label asp-for="DiscountValueType" class="form-label">Applicable To *</label>
                        <select asp-for="DiscountValueType" class="form-select">
                            <option value="@DiscountValueType.AllProducts">All Products</option>
                            <option value="@DiscountValueType.SpecificCategory">Specific Category</option>
                            <option value="@DiscountValueType.SpecificProduct">Specific Product</option>
                            <option value="@DiscountValueType.MinOrderAmount">Minimum Order Amount</option>
                        </select>
                        <span asp-validation-for="DiscountValueType" class="text-danger small"></span>
                    </div>

                    <!-- Status -->
                    <div class="mb-4">
                        <div class="form-check form-switch">
                            <input asp-for="IsActive" class="form-check-input" type="checkbox" role="switch" checked>
                            <label asp-for="IsActive" class="form-check-label">Active Discount</label>
                        </div>
                        <div class="form-text">Inactive discounts won't be available to customers</div>
                    </div>

                    <!-- Preview -->
                    <div class="card bg-light mb-4">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-eye me-2"></i>Discount Preview</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Code:</strong> <span id="previewCode" class="text-primary">SUMMER2024</span>
                                </div>
                                <div class="col-md-6">
                                    <strong>Value:</strong> <span id="previewValue">20%</span>
                                </div>
                                <div class="col-md-6">
                                    <strong>Valid:</strong> <span id="previewDate">@DateTime.Now.ToString("MM/dd/yyyy") - @DateTime.Now.AddMonths(1).ToString("MM/dd/yyyy")</span>
                                </div>
                                <div class="col-md-6">
                                    <strong>Status:</strong> <span class="badge bg-success">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex justify-content-between mt-4">
                        <a asp-area="Admin" asp-controller="Discount" asp-action="Index" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to List
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Create Discount
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Generate random discount code
        function generateCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('discountCode').value = result;
            updatePreview();
        }

        // Update preview based on form values
        function updatePreview() {
            const code = document.getElementById('discountCode').value || 'SUMMER2024';
            const type = document.getElementById('discountType').value;
            const value = document.querySelector('input[name="DiscountValue"]').value;
            const start = document.querySelector('input[name="DateStart"]').value;
            const end = document.querySelector('input[name="DateEnd"]').value;

            document.getElementById('previewCode').textContent = code;

            if (type === '@DiscountType.Percentage') {
                document.getElementById('previewValue').textContent = value + '%';
                document.getElementById('valueSuffix').textContent = '%';
            } else {
                document.getElementById('previewValue').textContent = new Intl.NumberFormat('vi-VN').format(value) + ' đ';
                document.getElementById('valueSuffix').textContent = 'đ';
            }

            if (start && end) {
                const startDate = new Date(start).toLocaleDateString();
                const endDate = new Date(end).toLocaleDateString();
                document.getElementById('previewDate').textContent = startDate + ' - ' + endDate;
            }
        }

        // Update preview when form changes
        document.getElementById('discountType').addEventListener('change', updatePreview);
        document.getElementById('discountCode').addEventListener('input', updatePreview);
        document.querySelector('input[name="DiscountValue"]').addEventListener('input', updatePreview);
        document.querySelector('input[name="DateStart"]').addEventListener('change', updatePreview);
        document.querySelector('input[name="DateEnd"]').addEventListener('change', updatePreview);

        // Set default dates
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, now.getDate());

            document.querySelector('input[name="DateStart"]').value = now.toISOString().slice(0, 16);
            document.querySelector('input[name="DateEnd"]').value = nextMonth.toISOString().slice(0, 16);

            updatePreview();
        });
    </script>

    <!-- jQuery Validation -->
    <partial name="_ValidationScriptsPartial" />
}