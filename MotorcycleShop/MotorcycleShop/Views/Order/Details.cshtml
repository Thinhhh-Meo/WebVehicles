@model MotorcycleShop.Models.Order
@using System.Globalization

@{
    ViewData["Title"] = $"Order #{Model.OrderId}";
}

<div class="container mt-5">
    <div class="dark-card mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="text-white mb-0">Order #@Model.OrderId</h4>

            <!-- STATUS BADGE -->
            <span class="status-badge @GetStatusBadgeClass(Model.Status)">
                @Model.Status
            </span>
        </div>

        <!-- ORDER INFO -->
        <div class="order-info-box mb-4">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-2">
                        <i class="fas fa-calendar-alt text-danger me-2"></i>
                        <strong>Order Date:</strong>
                        <span>@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</span>
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-user text-danger me-2"></i>
                        <strong>Customer:</strong>
                        <span>@(Model.User?.UserName ?? "N/A")</span>
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-phone text-danger me-2"></i>
                        <strong>Phone:</strong>
                        <span>@Model.PhoneNumber</span>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="mb-2">
                        <i class="fas fa-credit-card text-danger me-2"></i>
                        <strong>Payment:</strong>
                        <span class="payment-badge">@Model.PaymentMethod</span>
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-map-marker-alt text-danger me-2"></i>
                        <strong>Address:</strong>
                        <span>@Model.ShippingAddress</span>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Discount?.Code))
                    {
                        <div class="mb-2">
                            <i class="fas fa-tag text-danger me-2"></i>
                            <strong>Discount Code:</strong>
                            <span class="status-badge status-delivered">@Model.Discount.Code</span>
                        </div>
                    }
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Model.Note))
            {
                <div class="mt-3 pt-3 border-top">
                    <i class="fas fa-sticky-note text-danger me-2"></i>
                    <strong>Note:</strong>
                    <span class="text-muted">@Model.Note</span>
                </div>
            }
        </div>

        <!-- ORDER ITEMS -->
        <div class="table-responsive">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th class="text-end">Price</th>
                        <th class="text-center">Qty</th>
                        <th class="text-end">Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderDetails)
                    {
                        <tr>
                            <td>
                                <strong>@item.Product.Name</strong>
                                @if (!string.IsNullOrEmpty(item.Product.BrandName))
                                {
                                    <br />
                                    <small class="text-muted">Brand: @item.Product.BrandName</small>
                                }
                            </td>
                            <td class="text-end">@item.UnitPrice.ToString("N0") đ</td>
                            <td class="text-center">@item.Quantity</td>
                            <td class="text-end">@((item.Quantity * item.UnitPrice).ToString("N0")) đ</td>
                        </tr>
                    }
                </tbody>

                <tfoot>
                    <tr class="border-top">
                        <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                        <td class="text-end"><strong>@Model.TotalPrice.ToString("N0") đ</strong></td>
                    </tr>

                    @if (Model.DiscountAmount > 0)
                    {
                        <tr class="text-success">
                            <td colspan="3" class="text-end">
                                <strong>Discount (@Model.Discount?.Code):</strong>
                            </td>
                            <td class="text-end">
                                <strong>-@Model.DiscountAmount.ToString("N0") đ</strong>
                            </td>
                        </tr>
                    }

                    <tr class="table-active border-top">
                        <td colspan="3" class="text-end">
                            <strong class="fs-5 text-danger">Final Total:</strong>
                        </td>
                        <td class="text-end">
                            <strong class="fs-5 text-danger">@Model.FinalPrice.ToString("N0") đ</strong>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <a href="@Url.Action("MyOrders")" class="btn btn-outline-light">
        <i class="fas fa-arrow-left"></i> Back to My Orders
    </a>
</div>

<!-- ================= CSS ================= -->
<style>
    .dark-card {
        background: #151515;
        border-radius: 18px;
        padding: 24px;
        color: #fff;
    }

    .order-info-box {
        background: #1e1e1e;
        border-radius: 14px;
        padding: 18px 22px;
        box-shadow: 0 0 0 1px rgba(255,255,255,.08);
    }

    .payment-badge {
        background: rgba(220,53,69,.15);
        color: #dc3545;
        padding: 4px 12px;
        border-radius: 999px;
        font-weight: 600;
    }

    /* ===== STATUS BADGE (FIX LỖI PENDING) ===== */
    .status-badge {
        padding: 6px 14px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        display: inline-block;
    }

    .status-pending {
        background: #fff3cd;
        color: #856404;
    }

    .status-confirmed {
        background: #cff4fc;
        color: #055160;
    }

    .status-shipping {
        background: #cfe2ff;
        color: #084298;
    }

    .status-delivered {
        background: #d1e7dd;
        color: #0f5132;
    }

    .status-cancelled {
        background: #f8d7da;
        color: #842029;
    }

    .table-active {
        background: rgba(220, 53, 69, 0.1) !important;
    }
</style>

@functions {
    string GetStatusBadgeClass(OrderStatus s) => s switch
    {
        OrderStatus.Pending => "status-pending",
        OrderStatus.Confirmed => "status-confirmed",
        OrderStatus.Shipping => "status-shipping",
        OrderStatus.Delivered => "status-delivered",
        OrderStatus.Cancelled => "status-cancelled",
        _ => "status-pending"
    };
}
